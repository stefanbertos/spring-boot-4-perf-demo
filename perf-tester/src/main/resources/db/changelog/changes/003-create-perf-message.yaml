databaseChangeLog:
  - changeSet:
      id: 003-create-perf-message
      author: perf-tester
      comment: Create PERF_MESSAGE table to track individual message lifecycle
      changes:
        - createSequence:
            sequenceName: PERF_MESSAGE_SEQ
            startValue: 1
            incrementBy: 1
        - createTable:
            tableName: PERF_MESSAGE
            columns:
              - column:
                  name: ID
                  type: NUMBER(19)
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: TEST_RUN_ID
                  type: NUMBER(19)
                  constraints:
                    nullable: false
                  remarks: Foreign key to PERF_TEST_RUN
              - column:
                  name: MESSAGE_ID
                  type: VARCHAR2(100)
                  constraints:
                    nullable: false
                  remarks: Application-level message identifier
              - column:
                  name: CORRELATION_ID
                  type: VARCHAR2(100)
                  remarks: JMS correlation ID
              - column:
                  name: TRACE_ID
                  type: VARCHAR2(100)
                  remarks: Distributed tracing ID
              - column:
                  name: STATUS
                  type: VARCHAR2(20)
                  constraints:
                    nullable: false
                  remarks: "Message status: SENT, RECEIVED, FAILED, TIMEOUT"
              - column:
                  name: PAYLOAD_SIZE
                  type: NUMBER(10)
                  remarks: Message payload size in bytes
              - column:
                  name: SENT_AT
                  type: TIMESTAMP(6)
                  constraints:
                    nullable: false
                  remarks: Timestamp when message was sent
              - column:
                  name: RECEIVED_AT
                  type: TIMESTAMP(6)
                  remarks: Timestamp when response was received
              - column:
                  name: LATENCY_MS
                  type: NUMBER(10, 3)
                  remarks: End-to-end latency in milliseconds
              - column:
                  name: ERROR_MESSAGE
                  type: VARCHAR2(4000)
                  remarks: Error message if failed
              - column:
                  name: CREATED_AT
                  type: TIMESTAMP
                  defaultValueComputed: CURRENT_TIMESTAMP
                  constraints:
                    nullable: false
        - addForeignKeyConstraint:
            baseTableName: PERF_MESSAGE
            baseColumnNames: TEST_RUN_ID
            referencedTableName: PERF_TEST_RUN
            referencedColumnNames: ID
            constraintName: FK_PERF_MESSAGE_TEST_RUN
            onDelete: CASCADE
      rollback:
        - dropTable:
            tableName: PERF_MESSAGE
        - dropSequence:
            sequenceName: PERF_MESSAGE_SEQ

{
  "annotations": {
    "list": []
  },
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 1,
  "id": null,
  "links": [],
  "panels": [
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 0 },
      "panels": [],
      "title": "Vulnerability Overview",
      "type": "row"
    },
    {
      "title": "Total Critical Vulnerabilities",
      "type": "stat",
      "gridPos": { "h": 4, "w": 4, "x": 0, "y": 1 },
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "targets": [
        {
          "expr": "sum(trivy_image_vulnerabilities{severity=\"Critical\"})",
          "legendFormat": "Critical"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "value": null, "color": "green" },
              { "value": 1, "color": "red" }
            ]
          },
          "color": { "mode": "thresholds" }
        },
        "overrides": []
      },
      "options": { "colorMode": "background", "graphMode": "none", "textMode": "value_and_name" }
    },
    {
      "title": "Total High Vulnerabilities",
      "type": "stat",
      "gridPos": { "h": 4, "w": 4, "x": 4, "y": 1 },
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "targets": [
        {
          "expr": "sum(trivy_image_vulnerabilities{severity=\"High\"})",
          "legendFormat": "High"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "value": null, "color": "green" },
              { "value": 1, "color": "orange" }
            ]
          },
          "color": { "mode": "thresholds" }
        },
        "overrides": []
      },
      "options": { "colorMode": "background", "graphMode": "none", "textMode": "value_and_name" }
    },
    {
      "title": "Total Medium Vulnerabilities",
      "type": "stat",
      "gridPos": { "h": 4, "w": 4, "x": 8, "y": 1 },
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "targets": [
        {
          "expr": "sum(trivy_image_vulnerabilities{severity=\"Medium\"})",
          "legendFormat": "Medium"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "value": null, "color": "green" },
              { "value": 1, "color": "yellow" }
            ]
          },
          "color": { "mode": "thresholds" }
        },
        "overrides": []
      },
      "options": { "colorMode": "background", "graphMode": "none", "textMode": "value_and_name" }
    },
    {
      "title": "Total Low Vulnerabilities",
      "type": "stat",
      "gridPos": { "h": 4, "w": 4, "x": 12, "y": 1 },
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "targets": [
        {
          "expr": "sum(trivy_image_vulnerabilities{severity=\"Low\"})",
          "legendFormat": "Low"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "value": null, "color": "green" },
              { "value": 1, "color": "blue" }
            ]
          },
          "color": { "mode": "thresholds" }
        },
        "overrides": []
      },
      "options": { "colorMode": "background", "graphMode": "none", "textMode": "value_and_name" }
    },
    {
      "title": "Total Images Scanned",
      "type": "stat",
      "gridPos": { "h": 4, "w": 4, "x": 16, "y": 1 },
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "targets": [
        {
          "expr": "count(count by (container_name) (trivy_image_vulnerabilities))",
          "legendFormat": "Images"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "value": null, "color": "purple" }
            ]
          },
          "color": { "mode": "thresholds" }
        },
        "overrides": []
      },
      "options": { "colorMode": "background", "graphMode": "none", "textMode": "value_and_name" }
    },
    {
      "title": "Images with Critical/High CVEs",
      "type": "stat",
      "gridPos": { "h": 4, "w": 4, "x": 20, "y": 1 },
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "targets": [
        {
          "expr": "count(sum by (container_name) (trivy_image_vulnerabilities{severity=~\"Critical|High\"}) > 0)",
          "legendFormat": "At Risk"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "value": null, "color": "green" },
              { "value": 1, "color": "red" }
            ]
          },
          "color": { "mode": "thresholds" }
        },
        "overrides": []
      },
      "options": { "colorMode": "background", "graphMode": "none", "textMode": "value_and_name" }
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 5 },
      "panels": [],
      "title": "Vulnerabilities by Image",
      "type": "row"
    },
    {
      "title": "Critical Vulnerabilities by Image",
      "type": "bargauge",
      "gridPos": { "h": 10, "w": 12, "x": 0, "y": 6 },
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "targets": [
        {
          "expr": "sort_desc(sum by (container_name, image_tag) (trivy_image_vulnerabilities{severity=\"Critical\"}) > 0)",
          "legendFormat": "{{container_name}}:{{image_tag}}"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "value": null, "color": "green" },
              { "value": 1, "color": "orange" },
              { "value": 5, "color": "red" }
            ]
          },
          "color": { "mode": "thresholds" }
        },
        "overrides": []
      },
      "options": { "orientation": "horizontal", "displayMode": "gradient", "showUnfilled": true, "valueMode": "text" }
    },
    {
      "title": "High Vulnerabilities by Image",
      "type": "bargauge",
      "gridPos": { "h": 10, "w": 12, "x": 12, "y": 6 },
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "targets": [
        {
          "expr": "sort_desc(sum by (container_name, image_tag) (trivy_image_vulnerabilities{severity=\"High\"}) > 0)",
          "legendFormat": "{{container_name}}:{{image_tag}}"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "value": null, "color": "green" },
              { "value": 1, "color": "yellow" },
              { "value": 10, "color": "orange" },
              { "value": 50, "color": "red" }
            ]
          },
          "color": { "mode": "thresholds" }
        },
        "overrides": []
      },
      "options": { "orientation": "horizontal", "displayMode": "gradient", "showUnfilled": true, "valueMode": "text" }
    },
    {
      "title": "All Vulnerabilities by Image and Severity",
      "type": "table",
      "gridPos": { "h": 12, "w": 24, "x": 0, "y": 16 },
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "targets": [
        {
          "expr": "sum by (container_name, image_tag, severity) (trivy_image_vulnerabilities)",
          "legendFormat": "{{container_name}}:{{image_tag}} {{severity}}",
          "format": "table",
          "instant": true
        }
      ],
      "transformations": [
        {
          "id": "organize",
          "options": {
            "excludeByName": { "Time": true, "__name__": true },
            "renameByName": {
              "container_name": "Image",
              "image_tag": "Tag",
              "severity": "Severity",
              "Value": "Count"
            }
          }
        },
        {
          "id": "sortBy",
          "options": {
            "sort": [
              { "field": "Count", "desc": true }
            ]
          }
        }
      ],
      "fieldConfig": {
        "defaults": { "unit": "short" },
        "overrides": [
          {
            "matcher": { "id": "byName", "options": "Count" },
            "properties": [
              {
                "id": "thresholds",
                "value": {
                  "mode": "absolute",
                  "steps": [
                    { "value": null, "color": "green" },
                    { "value": 1, "color": "yellow" },
                    { "value": 10, "color": "orange" },
                    { "value": 50, "color": "red" }
                  ]
                }
              },
              { "id": "custom.displayMode", "value": "color-background" }
            ]
          }
        ]
      }
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 28 },
      "panels": [],
      "title": "Config Audits & Compliance",
      "type": "row"
    },
    {
      "title": "Config Audit Failures by Resource",
      "type": "bargauge",
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 29 },
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "targets": [
        {
          "expr": "sort_desc(sum by (resource_name, severity) (trivy_resource_configaudits{severity=~\"Critical|High\"}) > 0)",
          "legendFormat": "{{resource_name}} ({{severity}})"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "value": null, "color": "green" },
              { "value": 1, "color": "orange" },
              { "value": 5, "color": "red" }
            ]
          },
          "color": { "mode": "thresholds" }
        },
        "overrides": []
      },
      "options": { "orientation": "horizontal", "displayMode": "gradient", "showUnfilled": true, "valueMode": "text" }
    },
    {
      "title": "CIS & PSS Compliance",
      "type": "bargauge",
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 29 },
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "targets": [
        {
          "expr": "trivy_cluster_compliance{status=\"Pass\"}",
          "legendFormat": "{{title}} (Pass)"
        },
        {
          "expr": "trivy_cluster_compliance{status=\"Fail\"}",
          "legendFormat": "{{title}} (Fail)"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "value": null, "color": "green" }
            ]
          },
          "color": { "mode": "palette-classic" }
        },
        "overrides": []
      },
      "options": { "orientation": "horizontal", "displayMode": "gradient", "showUnfilled": true, "valueMode": "text" }
    },
    {
      "title": "Exposed Secrets by Image",
      "type": "bargauge",
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 37 },
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "targets": [
        {
          "expr": "sort_desc(sum by (container_name, image_tag) (trivy_image_exposedsecrets{severity=~\"Critical|High|Medium\"}) > 0)",
          "legendFormat": "{{container_name}}:{{image_tag}}"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "value": null, "color": "green" },
              { "value": 1, "color": "red" }
            ]
          },
          "color": { "mode": "thresholds" }
        },
        "overrides": []
      },
      "options": { "orientation": "horizontal", "displayMode": "gradient", "showUnfilled": true, "valueMode": "text" }
    },
    {
      "title": "RBAC Risk Assessments",
      "type": "bargauge",
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 37 },
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "targets": [
        {
          "expr": "sort_desc(sum by (resource_name, severity) (trivy_role_rbacassessments{severity=~\"Critical|High\"}) > 0)",
          "legendFormat": "{{resource_name}} ({{severity}})"
        },
        {
          "expr": "sort_desc(sum by (resource_name, severity) (trivy_clusterrole_clusterrbacassessments{severity=~\"Critical|High\"}) > 0)",
          "legendFormat": "{{resource_name}} ({{severity}})"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "value": null, "color": "green" },
              { "value": 1, "color": "orange" },
              { "value": 3, "color": "red" }
            ]
          },
          "color": { "mode": "thresholds" }
        },
        "overrides": []
      },
      "options": { "orientation": "horizontal", "displayMode": "gradient", "showUnfilled": true, "valueMode": "text" }
    }
  ],
  "schemaVersion": 39,
  "tags": ["trivy", "security"],
  "templating": { "list": [] },
  "time": { "from": "now-1h", "to": "now" },
  "timepicker": {},
  "timezone": "",
  "title": "Trivy Operator - Security Scanning",
  "uid": "trivy-operator",
  "version": 1
}
